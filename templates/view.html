<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>All Expenses</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome Icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">

    <style>
        body {
            background: linear-gradient(135deg, #f5f7fa, #c3cfe2);
            font-family: 'Segoe UI', sans-serif;
            padding: 30px;
        }

        .card {
            border: none;
            border-radius: 16px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
        }

        .card-header {
            background: linear-gradient(to right, #283e51, #485563);
            color: white;
            border-top-left-radius: 16px;
            border-top-right-radius: 16px;
            padding: 25px;
            text-align: center;
        }

        .card-header h3 {
            margin-bottom: 0;
        }

        .table th {
            background-color: #343a40 !important;
            color: white;
        }

        .btn-back {
            margin-top: 20px;
        }

        #searchInput {
            margin-bottom: 20px;
        }

        .filter-section label {
            font-weight: 500;
        }
    </style>
</head>
<body>

<div class="container">
    <div class="card">
        <div class="card-header">
            <h3><i class="fas fa-list me-2"></i>All Expenses</h3>
        </div>
        <div class="card-body">

            <!-- 🔎 Filter Form -->
            <form method="get" class="row g-3 filter-section">
                <div class="col-md-3">
                    <label for="start_date">Start Date</label>
                    <input type="date" id="start_date" name="start_date" class="form-control" value="{{ request.args.get('start_date', '') }}">
                </div>
                <div class="col-md-3">
                    <label for="end_date">End Date</label>
                    <input type="date" id="end_date" name="end_date" class="form-control" value="{{ request.args.get('end_date', '') }}">
                </div>
                <div class="col-md-2">
                    <label for="month">Month</label>
                    <select name="month" id="month" class="form-select">
                        <option value="">--</option>
                        {% for m in range(1,13) %}
                        <option value="{{ m }}" {% if request.args.get('month') == str(m) %}selected{% endif %}>{{ m }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-2">
                    <label for="year">Year</label>
                    <input type="number" name="year" id="year" class="form-control" value="{{ request.args.get('year', '') }}">
                </div>
                <div class="col-md-2 d-flex align-items-end">
                    <button type="submit" class="btn btn-primary w-100"><i class="fas fa-filter me-1"></i>Apply</button>
                </div>
            </form>

            {% if rows %}
                <!-- 🔍 Search Field -->
                <input type="text" id="searchInput" class="form-control mt-4" placeholder="Search expenses (date, item, category...)">

                <!-- 💰 Total Expenses -->
                <p class="mt-3 fw-bold">Total Expenses: ₹{{ '%.2f'|format(total) }}</p>

                <!-- 📄 Table -->
                <div class="table-responsive mt-3">
                    <table class="table table-bordered table-hover align-middle" id="expensesTable">
                        <thead class="table-dark text-center">
                            <tr>
                                <th>S.No</th>
                                <th>Date</th>
                                <th>Item</th>
                                <th>Price (₹)</th>
                                <th>Description</th>
                                <th>Category</th>
                                <th>Delete</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for row in rows %}
                            <tr>
                                <td class="text-center">{{ loop.index }}</td>
                                <td>{{ row[0] }}</td>
                                <td>{{ row[1] }}</td>
                                <td>₹{{ row[2] }}</td>
                                <td>{{ row[3] }}</td>
                                <td>{{ row[4] }}</td>
                                <td class="text-center">
<form action="{{ url_for('delete_expense_by_index', index=loop.index0) }}" method="post" onsubmit="return confirm('Are you sure you want to delete this expense?');">
    <button type="submit" class="btn btn-sm btn-danger">
        <i class="fas fa-trash"></i>
    </button>
</form>

                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% else %}
                <div class="alert alert-warning mt-4 text-center">No expenses found for the selected filter.</div>
            {% endif %}

            <div class="text-end btn-back">
                <a href="/" class="btn btn-outline-secondary">
                    <i class="fas fa-arrow-left me-1"></i> Back to Dashboard
                </a>
            </div>
        </div>
    </div>
</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<!-- 🔍 JavaScript Search Logic -->
<script>
    document.getElementById('searchInput')?.addEventListener('keyup', function () {
        const filter = this.value.toLowerCase();
        const rows = document.querySelectorAll('#expensesTable tbody tr');

        rows.forEach(row => {
            const cells = Array.from(row.children);
            const match = cells.some(cell => cell.textContent.toLowerCase().includes(filter));
            row.style.display = match ? '' : 'none';
        });
    });
</script>

</body>
</html>
